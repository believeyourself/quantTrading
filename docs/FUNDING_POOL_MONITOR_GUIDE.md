# 资金费率合约池监控器使用指南

## 功能概述

资金费率合约池监控器是一个专门用于监控币安1小时结算周期合约资金费率的工具，主要功能包括：

1. **缓存1小时结算周期合约** - 避免每次都重新扫描所有合约
2. **监控高资金费率合约** - 筛选资金费率 >= 0.5% 或 <= -0.5% 的合约
3. **合约池管理** - 自动维护符合条件的合约池
4. **Telegram消息推送** - 合约池变化时发送通知
5. **定时更新** - 自动更新缓存和检测资金费率

## 快速开始

### 1. 启动监控器

```bash
# 方法1: 使用批处理文件（推荐）
start_funding_monitor.bat

# 方法2: 直接运行Python脚本
python monitor_funding_pool.py
```

### 2. 选择运行模式

启动后会提示选择运行模式：

- **单次扫描**: 执行一次完整的扫描，适合测试
- **持续监控**: 持续运行监控，适合生产环境

### 3. 配置参数

可以通过修改 `config/settings.py` 来调整参数：

```json
{
  "funding_rate_threshold": 0.005,        // 资金费率阈值 (0.5%)
  "scan_interval_seconds": 1800,          // 扫描间隔 (30分钟)
  "cache_update_interval_seconds": 21600, // 缓存更新间隔 (6小时)
  "max_contracts_in_pool": 50,            // 最大合约数量
  "min_volume_24h": 1000000               // 最小24小时成交量
}
```

## 核心功能详解

### 1. 1小时结算合约缓存

- **缓存文件**: `cache/1h_funding_contracts_full.json`
- **缓存时间**: 1小时
- **更新频率**: 每6小时自动更新
- **优势**: 大幅减少API调用，提高效率

### 2. 资金费率检测

- **检测范围**: 仅检测1小时结算周期合约
- **阈值设置**: 0.5%（可调整）
- **检测逻辑**: 
  - 资金费率 >= 0.5% → 做多获得资金费
  - 资金费率 <= -0.5% → 做空获得资金费

### 3. 合约池管理

- **池子变化**: 自动添加/移除符合条件的合约
- **状态通知**: 每次更新都发送当前池子状态
- **变化通知**: 池子发生变化时发送详细通知

### 4. Telegram消息推送

#### 池子变化通知
```
🔄 资金费率合约池变化通知
⏰ 时间: 2024-01-15 14:30:00
📊 阈值: 0.5000%

🟢 新增合约 (2个):
  • BTCUSDT: 0.5200% (做多)
  • ETHUSDT: -0.5100% (做空)

🔴 移除合约 (1个):
  • ADAUSDT
```

#### 池子状态通知
```
📊 当前资金费率合约池状态
⏰ 更新时间: 2024-01-15 14:30:00
📈 合约数量: 3个
🎯 阈值: 0.5000%

  • BTCUSDT: 0.5200% (做多)
  • ETHUSDT: -0.5100% (做空)
  • SOLUSDT: 0.5050% (做多)
```

## 文件结构

```
quantTrading/
├── config/
│   ├── __init__.py
│   ├── settings.py           # 系统配置文件
│   └── proxy_settings.py     # 代理设置
├── cache/
│   ├── 1h_funding_contracts_full.json  # 1小时结算合约缓存
│   └── funding_pool_cache.json         # 合约池缓存
└── utils/
    ├── binance_funding.py           # 币安资金费率工具
    └── notifier.py                  # Telegram通知工具
```

## 配置说明

### 资金费率阈值

- **0.5%**: 较高阈值，适合保守策略
- **0.3%**: 中等阈值，平衡收益和风险
- **0.1%**: 较低阈值，更多交易机会

### 扫描间隔

- **30分钟**: 适合活跃市场
- **1小时**: 平衡及时性和资源消耗
- **2小时**: 适合稳定市场

### 缓存更新间隔

- **6小时**: 推荐设置，平衡准确性和效率
- **12小时**: 适合稳定市场
- **24小时**: 适合长期监控

## 使用建议

### 1. 参数调整

根据市场情况调整参数：

- **牛市**: 可以适当降低阈值（如0.3%）
- **熊市**: 建议提高阈值（如0.7%）
- **震荡市**: 使用中等阈值（如0.5%）

### 2. 风险管理

- 设置合理的最大合约数量
- 监控24小时成交量
- 定期检查池子状态

### 3. 性能优化

- 合理设置扫描间隔
- 监控API调用频率
- 定期清理缓存文件

## 故障排除

### 常见问题

1. **无法获取1小时结算合约**
   - 检查网络连接
   - 验证API权限
   - 尝试手动更新缓存

2. **Telegram消息发送失败**
   - 检查Bot Token配置
   - 验证Chat ID设置
   - 确认网络连接

3. **扫描速度过慢**
   - 调整限流参数
   - 减少扫描间隔
   - 检查API响应时间

### 日志查看

监控器会输出详细的运行日志，包括：
- 缓存更新状态
- 扫描进度
- 错误信息
- 池子变化

## 技术支持

如遇到问题，请检查：
1. 配置文件是否正确
2. 网络连接是否正常
3. API权限是否足够
4. 日志输出中的错误信息 