# 资金费率套利策略测试指南

## 概述

本文档介绍如何测试优化后的资金费率套利策略。该策略通过监控永续合约的资金费率，寻找套利机会。

## 测试脚本

### 1. 快速测试脚本 (`test_funding_quick.py`)

**用途**: 快速验证策略基本功能，适合日常测试

**特点**:
- 使用现有缓存数据，避免长时间等待
- 更保守的参数设置（更高的阈值）
- 快速完成，通常只需几秒钟
- 支持安全中断（Ctrl+C）

**运行方式**:
```bash
python test_funding_quick.py
```

**适用场景**:
- 验证策略是否正常工作
- 检查缓存状态
- 快速调试

### 2. 完整测试脚本 (`test_funding_arbitrage_optimized.py`)

**用途**: 完整测试策略功能，包括缓存更新

**特点**:
- 会更新合约缓存（可能需要几分钟）
- 测试完整的信号生成流程
- 性能测试
- 支持安全中断（Ctrl+C）

**运行方式**:
```bash
python test_funding_arbitrage_optimized.py
```

**适用场景**:
- 首次运行策略
- 测试缓存更新功能
- 性能评估
- 完整功能验证

## 优化改进

### 1. 限流优化
- 减少限流间隔：从2000ms降低到100ms
- 减少超时时间：从60秒降低到30秒
- 关闭详细日志输出

### 2. 分批处理
- 将合约获取分批进行，每批10个
- 批次间添加0.5秒休息时间
- 避免一次性请求过多导致限流

### 3. 错误处理
- 添加KeyboardInterrupt处理
- 更好的错误日志过滤
- 限流错误的特殊处理

### 4. 进度显示
- 显示批次处理进度
- 显示耗时统计
- 更清晰的状态信息

## 参数说明

### 快速测试参数
```python
strategy_params = {
    'funding_rate_threshold': 0.01,   # 1% - 更高的阈值
    'max_positions': 3,               # 最大3个持仓
    'min_volume': 5000000,            # 更高的最小成交量
    'exchanges': ['binance'],         # 只使用Binance
    'cache_duration': 1800,           # 缓存30分钟
    'update_interval': 900,           # 15分钟更新一次
    'funding_interval': 3600          # 1小时结算周期
}
```

### 完整测试参数
```python
strategy_params = {
    'funding_rate_threshold': 0.005,  # 0.5%
    'max_positions': 5,               # 最大5个持仓
    'min_volume': 1000000,            # 最小成交量
    'exchanges': ['binance'],         # 只使用Binance
    'cache_duration': 3600,           # 缓存1小时
    'update_interval': 1800,          # 30分钟更新一次
    'funding_interval': 3600          # 1小时结算周期
}
```

## 使用建议

### 首次使用
1. 先运行快速测试脚本验证基本功能
2. 确认代理连接正常
3. 检查缓存状态
4. 如果缓存无效，运行完整测试脚本

### 日常使用
1. 使用快速测试脚本检查策略状态
2. 监控资金费率变化
3. 根据需要调整参数

### 故障排除
1. **代理连接问题**: 检查代理配置
2. **限流问题**: 等待一段时间后重试
3. **缓存问题**: 运行完整测试更新缓存
4. **超时问题**: 检查网络连接

## 注意事项

1. **网络要求**: 需要稳定的网络连接和代理
2. **时间要求**: 完整测试可能需要几分钟时间
3. **资源消耗**: 策略会消耗一定的API配额
4. **中断处理**: 支持Ctrl+C安全中断

## 监控指标

### 性能指标
- 缓存更新时间
- 资金费率获取时间
- 信号生成时间

### 业务指标
- 缓存合约数量
- 符合条件的合约数量
- 生成的交易信号数量

## 联系支持

如果遇到问题，请检查：
1. 网络连接和代理设置
2. API密钥配置
3. 策略参数设置
4. 日志输出信息 